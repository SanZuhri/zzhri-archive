---
import IndexLayout from '@/layouts/IndexLayout.astro'
import PostList from '@/components/widgets/PostList.astro'
import { themeConfig } from '@/config'
import { getCollection } from 'astro:content'

export async function getStaticPaths() {
  const collections = ['gallery', 'thoughts', 'projects', 'media']

  return collections.map((collection) => ({
    params: { collection },
    props: { collection }
  }))
}

const { collection } = Astro.props

// Metadata untuk setiap collection
const collectionMeta: Record<string, { title: string; description: string }> = {
  gallery: {
    title: 'Gallery',
    description: 'Photos & visuals'
  },
  thoughts: {
    title: 'Thoughts',
    description: 'Reflections & ideas'
  },
  projects: {
    title: 'Projects',
    description: 'Work & creativity'
  },
  media: {
    title: 'Media',
    description: 'Books, music, movies, etc'
  }
}

const meta = collectionMeta[collection]
const posts = await getCollection(collection as 'thoughts' | 'media')
const filteredPosts = posts
  .filter((post: any) => !post.id.startsWith('_'))
  .sort((a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
---

<IndexLayout 
  title={meta.title + ' - ' + themeConfig.site.title} 
  description={meta.description}
  pageTitle={meta.title}
>
  <main>
    <p class="collection-description">{meta.description}</p>
    {filteredPosts.length > 0 ? (
      <PostList posts={filteredPosts} urlPrefix={`/collections/${collection}/`} />
    ) : (
      <p class="empty-message">No posts yet.</p>
    )}
  </main>
</IndexLayout>

<style>
  .collection-description {
    color: var(--text-secondary);
    opacity: 0.75;
    margin-bottom: 2rem;
    font-size: 1.1rem;
    line-height: 1.5;
  }
</style>
